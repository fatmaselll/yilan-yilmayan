<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Yƒ±lan Oyunu - Bug farkƒ± ile</title>
  <meta name="viewport" content="width=600, user-scalable=no">
  <style>
    body {
      background: linear-gradient(135deg, #3b82f6 0%, #f472b6 100%);
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    #topbar {
      width: 100vw;
      max-width: 700px;
      box-sizing: border-box;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(90deg, #60a5fa 0%, #f472b6 100%);
      border-bottom: 1px solid #2563eb;
      padding: 10px 20px;
      font-size: 20px;
      margin-top: 20px;
      border-radius: 10px 10px 0 0;
      user-select: none;
      box-shadow: 0 2px 12px #2563eb55;
    }
    #game-container {
      position: relative;
      width: 96vw;
      max-width: 700px;
      aspect-ratio: 1/1;
      height: auto;
      min-width: 320px;
      min-height: 320px;
      background: linear-gradient(135deg, #60a5fa 0%, #f472b6 100%);
      border: 2px solid #2563eb;
      border-radius: 0 0 16px 16px;
      box-shadow: 0 4px 32px #2563eb55;
      overflow: hidden;
    }
    canvas {
      display: block;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #60a5fa 0%, #f472b6 100%);
      border-radius: 0 0 16px 16px;
      box-shadow: 0 2px 16px #2563eb33;
    }
    .overlay {
      position: absolute;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(72, 168, 236, 0.96);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2;
      font-size: 28px;
      font-weight: 500;
      color: #fff;
      transition: opacity 0.3s;
    }
    .overlay button {
      margin-top: 24px;
      font-size: 22px;
      padding: 10px 36px;
      border-radius: 8px;
      border: none;
      background: linear-gradient(90deg, #2563eb 0%, #f472b6 100%);
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 12px #2563eb55;
      transition: background 0.2s;
    }
    .overlay button:hover {
      background: linear-gradient(90deg, #76c5fa 0%, #f472b6 100%);
    }
    #mobile-controls {
      display: none;
      margin: 18px 0 0 0;
      user-select: none;
    }
    .mc-row {
      display: flex;
      justify-content: center;
    }
    .mc-btn {
      width: 48px; height: 48px;
      margin: 4px;
      background: linear-gradient(135deg, #5ea5fc 0%, #f472b6 100%);
      border: 2px solid #2563eb;
      border-radius: 12px;
      font-size: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: #2563eb;
      box-shadow: 0 2px 8px #2563eb33;
      transition: background 0.2s;
      user-select: none;
    }
    .mc-btn:active {
      background: #4c98fb;
      color: #fff;
    }
    .flash {
      animation: flash 0.5s;
    }
    @keyframes flash {
      0% { box-shadow: 0 0 0 0 #f472b6; }
      50% { box-shadow: 0 0 40px 20px #f472b6; }
      100% { box-shadow: 0 0 0 0 #f472b6; }
    }
  </style>
</head>
<body>
  <div id="topbar">
    <span>Skor: <span id="score">0</span></span>
    <span>En Y√ºksek Skor: <span id="highscore">0</span></span>
    <span>
      <button id="sound-btn" style="font-size:18px; background:#eee; color:#333; border-radius:6px; border:none; padding:4px 12px; cursor:pointer;">üîä</button>
      <button id="pause-btn" style="font-size:18px; background:#eee; color:#333; border-radius:6px; border:none; padding:4px 12px; cursor:pointer;">‚è∏Ô∏è</button>
    </span>
  </div>
  <div id="game-container">
    <canvas id="game" width="600" height="600"></canvas>
    <div id="start-overlay" class="overlay">
      <div style="font-family: cursive; color: #34256c; font-size: xx-large;" >Yƒ±lan Oyunu üêç<br><span style="font-size:18px; color:#140909;">Ama sen yƒ±lma ehehehehe</span></div>
      <button id="start-btn">Ba≈üla</button>
      <div style="font-size:16px; color:#3a12ce; margin-top:18px;"><br> BU OYUNDA KEDƒ∞ KURALLARI AKTƒ∞FTƒ∞R  <br> </div>
    </div>
    <div id="gameover-overlay" class="overlay" style="display:none;">
      <div id="go-msg">Oyun Bitti</div>
      <div style="font-size:20px; margin:10px 0;">
        Skor: <span id="final-score">0</span><br>
        En Y√ºksek Skor: <span id="final-highscore">0</span>
      </div>
      <button id="restart-btn">Yeniden Ba≈ülat</button>
      <div style="font-size:16px; color:#888; margin-top:18px;">Kƒ±sayol: Enter</div>
    </div>
  </div>
  <div id="mobile-controls">
    <div class="mc-row">
      <div class="mc-btn" data-dir="up">‚ñ≤</div>
    </div>
    <div class="mc-row">
      <div class="mc-btn" data-dir="left">‚óÄ</div>
      <div style="width:48px;"></div>
      <div class="mc-btn" data-dir="right">‚ñ∂</div>
    </div>
    <div class="mc-row">
      <div class="mc-btn" data-dir="down">‚ñº</div>
    </div>
  </div>
  <script>
    // --- Oyun Ayarlarƒ± ---
    const GRID_SIZE = 20; // 20x20 grid (√∂nceden 30)
    const CELL_SIZE = 30; // 30px (√∂nceden 20)
    const CANVAS_SIZE = GRID_SIZE * CELL_SIZE; // 600x600
    const TICK_RATE = 1000 / 6; // 1.5 kat daha yava≈ü (eski 9 FPS -> 6 FPS)
    // Canlƒ± ve net renkler
    const SNAKE_COLORS = [
      "#2563eb", // canlƒ± mavi
      "#3b82f6", // parlak mavi
      "#f472b6", // canlƒ± pembe
      "#a21caf", // canlƒ± eflatun
      "#f59e42", // turuncu
      "#fbbf24", // sarƒ±
      "#9333ea", // mor
      "#f43f5e"  // kƒ±rmƒ±zƒ±msƒ± pembe
    ];
    const SNAKE_HEAD_COLOR = "#2563eb";
    const SNAKE_RADIUS = 7;
    const SNAKE_HEAD_RADIUS = 9;
    const BG_COLOR = "#60a5fa";
    const GRID_COLOR = "#2563eb";
    const EYE_COLOR = "#fff";
    const EYE_OUTLINE = "#f472b6";
    const EYE_RADIUS = 2.8;
    const EYE_OFFSET = 5;
    const FOOD_EMOJIS = [
      "‚òï","üòª","üê£","üêæ","üåø","üåº","üå∏","üåπ","üåï","üåô","‚ú®","üí´","üêà"
    ];
     const FOOD_COLORS = [
      "#3b82f6", "#f472b6", "#a21caf", "#f59e42",
      "#fbbf24", "#9333ea", "#f43f5e", "#60a5fa",
      "#f472b6", "#fbbf24", "#2563eb", "#a21caf", "#f43f5e"
    ];
   
    const FLASH_SCORE = 10; // Her 10 puanda parlama
    const SOUND_EAT = [220, 440];
    const SOUND_DEAD = [110, 80];
    let soundOn = true;

    // --- Oyun Durumlarƒ± ---
    let snake, direction, nextDirection, food, score, highscore, gameState, tickTimer, flashAnim, foodTone;
    let paused = false;
    let inputLocked = false; // Aynƒ± tickte birden fazla y√∂n engeli

    // --- Canvas ve UI ---
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const highscoreEl = document.getElementById("highscore");
    const startOverlay = document.getElementById("start-overlay");
    const gameoverOverlay = document.getElementById("gameover-overlay");
    const finalScoreEl = document.getElementById("final-score");
    const finalHighscoreEl = document.getElementById("final-highscore");
    const startBtn = document.getElementById("start-btn");
    const restartBtn = document.getElementById("restart-btn");
    const soundBtn = document.getElementById("sound-btn");
    const pauseBtn = document.getElementById("pause-btn");
    const goMsg = document.getElementById("go-msg");

    // --- Mobil Kontroller ---
    document.querySelectorAll('.mc-btn').forEach(btn => {
      btn.addEventListener('touchstart', e => {
        e.preventDefault();
        handleDirection(btn.dataset.dir);
      });
    });

    // --- Ba≈ülangƒ±√ß ve Skor Y√ºkleme ---
    highscore = Number(localStorage.getItem("snake_highscore") || 0);
    highscoreEl.textContent = highscore;

    // --- Oyun Ba≈ülatƒ±cƒ± ---
    function init() {
      snake = [
        {x: Math.floor(GRID_SIZE/2), y: Math.floor(GRID_SIZE/2)},
        {x: Math.floor(GRID_SIZE/2)-1, y: Math.floor(GRID_SIZE/2)},
        {x: Math.floor(GRID_SIZE/2)-2, y: Math.floor(GRID_SIZE/2)}
      ];
      direction = {x:1, y:0};
      nextDirection = {x:1, y:0};
      score = 0;
      foodTone = 0;
      paused = false;
      inputLocked = false;
      placeFood();
      updateScore();
      flashAnim = false;
      clearInterval(tickTimer);
      tickTimer = null;
      draw();
    }

    // --- Oyun D√∂ng√ºs√º ---
    function startGame() {
      gameState = "playing";
      startOverlay.style.display = "none";
      gameoverOverlay.style.display = "none";
      init();
      tickTimer = setInterval(gameTick, TICK_RATE);
    }

    function pauseGame() {
      if (gameState !== "playing") return;
      paused = !paused;
      pauseBtn.textContent = paused ? "‚ñ∂Ô∏è" : "‚è∏Ô∏è";
      if (paused) {
        clearInterval(tickTimer);
        tickTimer = null;
      } else {
        tickTimer = setInterval(gameTick, TICK_RATE);
      }
    }

    function gameOver(reason) {
      gameState = "gameover";
      clearInterval(tickTimer);
      tickTimer = null;
      if (score > highscore) {
        highscore = score;
        localStorage.setItem("snake_highscore", highscore);
      }
      finalScoreEl.textContent = score;
      finalHighscoreEl.textContent = highscore;
      highscoreEl.textContent = highscore;
      gameoverOverlay.style.display = "flex";
      // √áarpƒ±≈üma sebebine g√∂re mesaj
      if (reason === "wall") {
        goMsg.textContent = "Duvara √ßarptƒ±n!";
      } else if (reason === "self") {
        goMsg.textContent = "Kendine √ßarptƒ±n!";
      } else {
        goMsg.textContent = "Oyun Bitti";
      }
      playSound(SOUND_DEAD);
    }

    function gameTick() {
      if (paused) return;
      // Y√∂n g√ºncellemesi (aynƒ± tickte birden fazla tu≈ü engeli)
      direction = {...nextDirection};
      inputLocked = false;

      // Yeni ba≈ü pozisyonu
      const head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};

      // Duvar √ßarpma kontrol√º
      if (
        head.x < 0 || head.x >= GRID_SIZE ||
        head.y < 0 || head.y >= GRID_SIZE
      ) {
        gameOver("wall");
        return;
      }
      // Kendine √ßarpma kontrol√º
      if (
        snake.some(seg => seg.x === head.x && seg.y === head.y)
      ) {
        gameOver("self");
        return;
      }

      // Yƒ±lanƒ± ilerlet
      snake.unshift(head);

      // Yem yeme kontrol√º
      if (head.x === food.x && head.y === food.y) {
        score++;
        foodTone = Math.floor(score/5) % FOOD_COLORS.length;
        updateScore();
        playSound(SOUND_EAT);
        if (score % FLASH_SCORE === 0) flash();
        placeFood();
      } else {
        snake.pop();
      }

      draw();
    }

    // --- Skor ve Parlama ---
    function updateScore() {
      scoreEl.textContent = score;
      highscoreEl.textContent = highscore;
    }
    function flash() {
      canvas.classList.add("flash");
      setTimeout(()=>canvas.classList.remove("flash"), 400);
    }

    // --- Yem √áizimi (SVG/Emoji/Rect) ---
    function drawFood() {
      const x = food.x*CELL_SIZE, y = food.y*CELL_SIZE;
      // Rastgele emoji se√ßimi (her yem √ßƒ±kƒ±≈üƒ±nda farklƒ±)
      let emoji = FOOD_EMOJIS[foodTone % FOOD_EMOJIS.length];
      let color = FOOD_COLORS[foodTone % FOOD_COLORS.length];
      // Emoji fallback
      ctx.font = "22px Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(emoji, x+CELL_SIZE/2, y+CELL_SIZE/2+1);
      // Eƒüer emoji y√ºklenmezse, renkli kare
      ctx.save();
      ctx.strokeStyle = "#bfa05e";
      ctx.lineWidth = 1;
      ctx.fillStyle = color;
      ctx.globalAlpha = 0.7;
      ctx.fillRect(x+3, y+3, CELL_SIZE-6, CELL_SIZE-6);
      ctx.globalAlpha = 1;
      ctx.strokeRect(x+3, y+3, CELL_SIZE-6, CELL_SIZE-6);
      ctx.restore();
    }

    // --- Yem Yerle≈ütirme ---
    function placeFood() {
      let empty = [];
      for (let y=0; y<GRID_SIZE; y++) {
        for (let x=0; x<GRID_SIZE; x++) {
          if (!snake.some(seg => seg.x===x && seg.y===y)) empty.push({x,y});
        }
      }
      if (empty.length === 0) return;
      const idx = Math.floor(Math.random()*empty.length);
      food = empty[idx];
      // Her yeni yem i√ßin rastgele emoji tonu
      foodTone = Math.floor(Math.random() * FOOD_EMOJIS.length);
    }

    // --- √áizim Fonksiyonu ---
    function draw() {
      // Arka plan ve grid
      ctx.fillStyle = BG_COLOR;
      ctx.fillRect(0,0,CANVAS_SIZE,CANVAS_SIZE);
      ctx.save();
      // Hafif degrade grid arka planƒ±
      let grad = ctx.createLinearGradient(0, 0, CANVAS_SIZE, CANVAS_SIZE);
      grad.addColorStop(0, "#e0e7ff");
      grad.addColorStop(1, "#f3e8ff");
      ctx.globalAlpha = 0.5;
      ctx.fillStyle = grad;
      ctx.fillRect(0,0,CANVAS_SIZE,CANVAS_SIZE);
      ctx.globalAlpha = 1;
      ctx.restore();

      // Grid √ßizgileri
      ctx.strokeStyle = GRID_COLOR;
      ctx.lineWidth = 0.7;
      for (let i=1; i<GRID_SIZE; i++) {
        ctx.beginPath();
        ctx.moveTo(i*CELL_SIZE,0);
        ctx.lineTo(i*CELL_SIZE,CANVAS_SIZE);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0,i*CELL_SIZE);
        ctx.lineTo(CANVAS_SIZE,i*CELL_SIZE);
        ctx.stroke();
      }

      // Yem (emoji veya renkli kare)
      drawFood();

      // Yƒ±lan
      for (let i=snake.length-1; i>=0; i--) {
        const seg = snake[i];
        ctx.save();
        ctx.translate(seg.x*CELL_SIZE+CELL_SIZE/2, seg.y*CELL_SIZE+CELL_SIZE/2);
        if (i===0) {
          // Ba≈ü
          ctx.fillStyle = SNAKE_HEAD_COLOR;
          roundRect(ctx, -CELL_SIZE/2+2, -CELL_SIZE/2+2, CELL_SIZE-4, CELL_SIZE-4, SNAKE_HEAD_RADIUS);
          ctx.shadowColor = "#818cf8";
          ctx.shadowBlur = 10;
          ctx.fill();
          ctx.shadowBlur = 0;
          // G√∂zler
          drawEyes(direction);
        } else {
          // G√∂vde i√ßin renk ge√ßi≈üi
          let colorIdx = (i + score) % SNAKE_COLORS.length;
          ctx.fillStyle = SNAKE_COLORS[colorIdx];
          roundRect(ctx, -CELL_SIZE/2+3, -CELL_SIZE/2+3, CELL_SIZE-6, CELL_SIZE-6, SNAKE_RADIUS);
          ctx.globalAlpha = 0.95 - (i/snake.length)*0.3;
          ctx.fill();
          ctx.globalAlpha = 1;
        }
        ctx.restore();
      }
    }

    // --- Yƒ±lanƒ±n Ba≈üƒ±na G√∂z √áizimi ---
    function drawEyes(dir) {
      ctx.save();
      ctx.strokeStyle = EYE_OUTLINE;
      ctx.lineWidth = 1;
      let dx = dir.x, dy = dir.y;
      // G√∂z pozisyonlarƒ± (y√∂nlere g√∂re)
      let ex1, ey1, ex2, ey2;
      if (dx === 1) { // saƒü
        ex1 = 4; ey1 = -EYE_OFFSET;
        ex2 = 4; ey2 = EYE_OFFSET;
      } else if (dx === -1) { // sol
        ex1 = -4; ey1 = -EYE_OFFSET;
        ex2 = -4; ey2 = EYE_OFFSET;
      } else if (dy === 1) { // a≈üaƒüƒ±
        ex1 = -EYE_OFFSET; ey1 = 4;
        ex2 = EYE_OFFSET; ey2 = 4;
      } else { // yukarƒ±
        ex1 = -EYE_OFFSET; ey1 = -4;
        ex2 = EYE_OFFSET; ey2 = -4;
      }
      // G√∂zler
      ctx.beginPath();
      ctx.arc(ex1, ey1, EYE_RADIUS, 0, 2*Math.PI);
      ctx.arc(ex2, ey2, EYE_RADIUS, 0, 2*Math.PI);
      ctx.fillStyle = EYE_COLOR;
      ctx.fill();
      ctx.stroke();
      ctx.restore();
    }

    // --- Yuvarlatƒ±lmƒ±≈ü Dikd√∂rtgen Yardƒ±mcƒ±sƒ± ---
    function roundRect(ctx, x, y, w, h, r) {
      ctx.beginPath();
      ctx.moveTo(x+r, y);
      ctx.lineTo(x+w-r, y);
      ctx.quadraticCurveTo(x+w, y, x+w, y+r);
      ctx.lineTo(x+w, y+h-r);
      ctx.quadraticCurveTo(x+w, y+h, x+w-r, y+h);
      ctx.lineTo(x+r, y+h);
      ctx.quadraticCurveTo(x, y+h, x, y+h-r);
      ctx.lineTo(x, y+r);
      ctx.quadraticCurveTo(x, y, x+r, y);
      ctx.closePath();
    }

    // --- Klavye Kontrolleri ---
    document.addEventListener("keydown", e => {
      if (gameState === "start" && (e.key === "Enter" || e.key === " ")) {
        startGame();
        return;
      }
      if (gameState === "gameover" && e.key === "Enter") {
        startGame();
        return;
      }
      if (gameState !== "playing") return;
      if (e.key === "p" || e.key === "P") {
        pauseGame();
        return;
      }
      if (inputLocked) return;
      let dir = null;
      if (["ArrowUp","w","W"].includes(e.key)) dir = {x:0, y:-1};
      else if (["ArrowDown","s","S"].includes(e.key)) dir = {x:0, y:1};
      else if (["ArrowLeft","a","A"].includes(e.key)) dir = {x:-1, y:0};
      else if (["ArrowRight","d","D"].includes(e.key)) dir = {x:1, y:0};
      if (dir) {
        handleDirection(dir);
      }
    });

    // --- Mobil ve Klavye Y√∂n Kontrol√º ---
    function handleDirection(dir) {
      if (inputLocked || paused || gameState !== "playing") return;
      let d = typeof dir === "string" ? (
        dir==="up"?{x:0,y:-1} : dir==="down"?{x:0,y:1} : dir==="left"?{x:-1,y:0} : {x:1,y:0}
      ) : dir;
      // Ters y√∂ne anƒ±nda d√∂n√º≈ü engeli
      if (d.x === -direction.x && d.y === -direction.y) return;
      nextDirection = d;
      inputLocked = true;
    }

    // --- Butonlar ---
    startBtn.onclick = startGame;
    restartBtn.onclick = startGame;
    soundBtn.onclick = () => {
      soundOn = !soundOn;
      soundBtn.textContent = soundOn ? "üîä" : "üîá";
    };
    pauseBtn.onclick = pauseGame;

    // --- Ses Efektleri (opsiyonel, devre dƒ±≈üƒ± bƒ±rakƒ±labilir) ---
    function playSound(freqs) {
      if (!soundOn || !window.AudioContext) return;
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        freqs.forEach((f,i) => {
          const o = ctx.createOscillator();
          const g = ctx.createGain();
          o.type = "sine";
          o.frequency.value = f;
          o.connect(g);
          g.connect(ctx.destination);
          g.gain.value = 0.08;
          o.start(ctx.currentTime + i*0.05);
          o.stop(ctx.currentTime + 0.12 + i*0.05);
        });
        setTimeout(()=>ctx.close(), 300);
      } catch(e){}
    }

    // --- Oyun Durumlarƒ± Ba≈ülangƒ±√ß ---
    function showStart() {
      gameState = "start";
      startOverlay.style.display = "flex";
      gameoverOverlay.style.display = "none";
      pauseBtn.textContent = "‚è∏Ô∏è";
      draw();
    }
    showStart();

    // --- Responsive Canvas ---
    function resizeCanvas() {
      // Container'ƒ±n geni≈üliƒüine g√∂re canvas boyutunu ayarla
      const container = document.getElementById("game-container");
      let size = Math.min(window.innerWidth * 0.96, 700, window.innerHeight * 0.7);
      container.style.width = size + "px";
      container.style.height = size + "px";
      canvas.style.width = size + "px";
      canvas.style.height = size + "px";
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // --- Nasƒ±l √áalƒ±≈üƒ±r? ---
    /*
      - Oyun grid tabanlƒ±dƒ±r (30x30, 20px h√ºcre).
      - Yƒ±lan ok tu≈ülarƒ±/WASD veya ekrandaki tu≈ülarla y√∂nlendirilir.
      - Ters y√∂ne anƒ±nda d√∂n√º≈ü engellenir.
      - Yem T√ºrk √ßay bardaƒüƒ± (SVG/emoji/renkli kare) olarak rastgele bo≈ü h√ºcreye √ßƒ±kar.
      - Yƒ±lan yem yedik√ße uzar, skor artar, her 5 puanda √ßay bardaƒüƒ± tonu deƒüi≈üir.
      - Duvara veya kendine √ßarpƒ±nca oyun biter, skorlar g√∂sterilir.
      - Skor ve en y√ºksek skor √ºstte, pause (P), ses a√ß/kapa, mobil tu≈ü takƒ±mƒ± desteƒüi vardƒ±r.
      - Her 10 puanda kƒ±sa bir parlama animasyonu olur.
      - Kod fonksiyonlara ayrƒ±lmƒ±≈ü, a√ßƒ±klamalƒ±dƒ±r.
    */
  </script>
</body>
<footer style="width:100vw;max-width:700px;margin:32px auto 0 auto;display:flex;justify-content:center;align-items:center;">
  <span style="font-style:italic;font-size:20px;color:#fff;text-shadow:0 2px 8px #2563eb,0 0 2px #f472b6;">
    Error error dediƒüin nedir ki g√ºl√ºm, <br> ben senin i√ßin t√ºm buglarƒ± debug etmeyi g√∂ze almƒ±≈üƒ±m...
  </span>
</footer>
</html>